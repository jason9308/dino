# Fpga 小恐龍遊戲

# 基於 FPGA 的像素化小恐龍遊戲

![image](https://hackmd.io/_uploads/rJKZ2Troxe.png)

## 一、專題簡介
這個課程專題旨在實作一款 **像素化小恐龍遊戲**（類似 Chrome Dino Game），以 **FPGA + Verilog HDL** 實現，並且顯示在LCD螢幕。  
遊戲主要功能包括：
- 恐龍奔跑與跳躍
- 仙人掌偽隨機生成與移動
- 地面與仙人掌同步移動
- 背景雲層緩慢移動
- 分數統計與顯示
- 碰撞檢測與遊戲結束判定  

**遊戲流程**：玩家透過按鍵控制恐龍 → 躲避障礙 → 分數隨時間累加 → 若發生碰撞則遊戲結束。

---

## 二、模組設計與功能
| 模組名稱 | 功能 | 技術重點 |
|----------|------|----------|
| **game_crtl** | 遊戲邏輯控制（檢查恐龍是否撞到障礙物<br>以及計算當前的移動速度） | FSM 狀態機 |
| **dino_crtl** | 恐龍狀態管理（跑步/ 跳躍 / 死亡） | 跳躍高度公式 `jump_height = (jump_time * 14) - (jump_time * jump_time) / 4`，動畫切換 |
| **dino** | 主模組 | 負責實例化並整合所有submodule |
| **cactus** | 仙人掌生成與移動 | 由LFSR偽隨機數產生器<br>決定場上仙人掌數量以及大小，計算仙人掌偏移量 |
| **cloud** | 背景雲層顯示 | 偽隨機決定雲朵出現時機和高度，低速移動製造層次感 |
| **ground** | 地面循環滾動 | 取餘數運算模擬無限滾動 |
| **score** | 分數統計與顯示 | 計數器，除法/取餘數轉換為數字字型 |
| **random_3 / random_5** | 偽隨機數生成 | LFSR 實作，不依賴 `$random` |
| **key_debounce** | 按鍵防抖動 | 時序過濾，避免誤觸發 |
| **clk_div** | 時鐘分頻 | 提供動畫與遊戲節拍 |
| **lcd_display** | 各物件圖層合成 | px 資料 OR 運算，處理遮擋關係 |
| **lcd_driver** | LCD 驅動與時序控制 | HSYNC / VSYNC 產生，座標掃描 |

## 三、重點介紹

### 3.1 Bitmap 方式顯示圖案
遊戲中的恐龍、仙人掌、雲朵、地面等物件皆以 **bitmap 位元圖** 的方式儲存與繪製。  
- 每個圖案對應到一個二維陣列，陣列值為 `1` 表示該像素需要顯示，`0` 表示背景。  
- 在掃描座標 (`pixel_xpos`, `pixel_ypos`) 到達對應範圍時，讀取 bitmap 判斷是否輸出像素。  
- 這種方法能有效管理圖形，並且方便切換不同影格（例如恐龍的奔跑動畫）。

(以下是一個仙人掌圖形的例子)
![image](https://hackmd.io/_uploads/S1ohM0rsge.png)

---

### 3.2 仙人掌的管理
仙人掌的移動與生成採用 **位移偏移量 (offset)** 控制：  
- 仙人掌的出現間距、數量、大小由 **LFSR 偽隨機數** 決定  
- 遊戲進行中，每一幀 `offset = offset + speed`，使仙人掌持續往左移動。  
- 當 `offset` 超出螢幕範圍後，再次依照偽隨機間隔生成新的仙人掌組合。  
此方法簡單高效，能模擬出障礙物連續出現的效果。

---

### 3.3 恐龍的高度計算公式
恐龍的跳躍以一個 **離散化的拋物線公式** 模擬重力效果：  

$jump height = (jump time \times 14) - \frac{(jump time^2)}{4}$


- `jump_time` 為跳躍經過的時間（以遊戲節拍計數）。  
- 第一項 `(jump_time * 14)` 模擬初速度上升。  
- 第二項 `-(jump_time^2 / 4)` 模擬重力加速度使角色下降。   

（下圖顯示此公式對應的函數曲線，可看出小恐龍跳起的最大高度為200個像素）
![image](https://hackmd.io/_uploads/Skkd4RHsxl.png)


---

## 四、Demo影片
https://youtu.be/REgD8TW-fTc?si=9wOqWMmLq1FOU-k9
